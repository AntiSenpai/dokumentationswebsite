{# templates/customer/index.html.twig #}
{% extends 'base.html.twig' %}

{% block body %}
<!DOCTYPE html>
<html lang="de">
<link rel="stylesheet" href="{{ asset('css/customer.css') }}">
  <div class="search-add-box">
  <div class="search-box">
  <form action="{{ path('customer_index') }}" method="get">
    <input type="text" name="search" placeholder="Kunden suchen...">
    <button class="search-btn" type="submit">üîç</button>
  </form>
  </div>
  <button type="button" class="btn btn-primary" id="addCustomerButton" data-toggle="modal" data-target="#createCustomerModal">Neuer Eintrag</button>
{{ include('customer/create.html.twig', {'form': createForm}) }}
</div>

<h2>Kundenverzeichnis</h2>

<div class="customer-list">
<div class="customer-list-header">
  <span>ID</span>
  <span>Name</span>
  <span>Standort</span>
  <span>Erstellt am</span>
</div>
  {% for customer in customers %}
  <a href="{{ path('customer_detail', {'id': customer.id}) }}">
  <div id="customerList" class="customer-entry {% if loop.index is odd %}customer-odd{% endif %}">
    <div>{{ customer.id }}</div>
    <div>{{ customer.name }}</div>
    <div>{{ customer.location }}</div>
    <div>{{ customer.createdAt|date('d.m.Y') }}</div>
  </div>
  </a>
  {% endfor %}
</div>

<script>
   document.getElementById('customerSearch').addEventListener('input', function(e) {
            var searchValue = e.target.value.toLowerCase();
            document.querySelectorAll('.customer-entry').forEach(function(customer) {
                var name = customer.querySelector('.customer-name').textContent.toLowerCase();
                customer.style.display = name.includes(searchValue) ? 'block' : 'none';
            });
        });

        function showDetails(customerId) {
            // Logik f√ºr die Anzeige von Details und Unterstandorten des Kunden
            console.log('Kundendetails f√ºr: ' + customerId);
        }
</script>
<script>
document.getElementById('addCustomerButton').addEventListener('click', function() {
    $('#createCustomerModal').modal('show');
});

</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var form = document.getElementById('customerForm'); 
    form.addEventListener('submit', function (e) {
        e.preventDefault(); 
        var formData = new FormData(form);
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/doku/create', true); 

       xhr.onload = function () {
    if (xhr.status === 200) {
        $('#createCustomerModal').modal('hide');
        window.location.reload(); // This line reloads the page
    } else {
        console.error('An error occurred:', xhr.responseText);
    }
};


function updateCustomerList() {
    fetch('/doku/kundendoku')
        .then(response => response.text())
        .then(html => {
            document.getElementById('customerList').innerHTML = html;
        })
        .catch(error => console.error('Error updating customer list:', error));
}

        xhr.send(formData); 
    });
});
</script>
</html>
{% endblock %}
